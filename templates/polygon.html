{% extends 'base.html' %}
{% block title %}Polygon Labeling â€“ Sentinel Labeler{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
<style>
  /* Page-specific tweaks */
  .map-wrap { height: calc(100vh - 110px); }

  #map {
    position: relative;
    height: 100%;
    border-radius: 14px;
    overflow: hidden;
    border: 1px solid #1c2435;
    background: #0b0f19;
  }

  /* Make draw/zoom controls small but stable (no transform on container) */
  .leaflet-bar a, .leaflet-bar a:hover {
    width: 26px;
    height: 26px;
    line-height: 26px;
  }
  .leaflet-draw-toolbar a {
    width: 26px !important;
    height: 26px !important;
    line-height: 26px !important;
    background: #fff;
    border: 1px solid #cfd6e4;
  }
  .leaflet-draw-toolbar a:hover { background: #f3f4f6; }

  /* Ensure map controls are above canvases */
  #maskCanvas, #cursorCanvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: 200;
    pointer-events: none;
  }
  .leaflet-top, .leaflet-bottom, .leaflet-control-container { z-index: 1000; }
</style>
{% endblock %}

{% block main %}
<div class="map-wrap">
  <div id="map" class="map">
    <canvas id="maskCanvas"></canvas>
    <canvas id="cursorCanvas"></canvas>
  </div>
</div>
{% endblock %}

{% block right_panel %}
{{ super() }}
<div class="section">
  <div class="muted">Brush</div>
  <div class="toolbar" style="gap:10px; flex-wrap:wrap; align-items:center">
    <label>Size
      <input id="brushSize" type="range" min="2" max="128" step="1" value="16" />
      <span id="brushSizeVal">16 px</span>
    </label>
    <label>Hardness
      <input id="brushHard" type="range" min="0" max="1" step="0.05" value="1" />
      <span id="brushHardVal">1.00</span>
    </label>
    <button id="toggleBrushBtn" class="btn">Brush</button>
    <div class="seg">
      <button id="modeVeg" class="btn primary">Vegetation</button>
      <button id="modeBg" class="btn">Erase</button>
    </div>
    <label style="display:flex; align-items:center; gap:6px;">
      <input id="clipToPoly" type="checkbox" checked />
      Clip to selected polygon
    </label>
    <button id="clearMask" class="btn">Clear</button>
    <button id="saveMaskBtn" class="btn primary">Save</button>
    <span id="maskSaveStatus" class="muted" style="font-size:12px"></span>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>
<script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js" defer></script>
<script src="https://unpkg.com/leaflet-geometryutil" defer></script>
<script src="https://unpkg.com/leaflet-snap/leaflet.snap.js" defer></script>
<script src="{{ url_for('static', filename='js/polygon.js') }}" defer></script>
{% endblock %}